{% extends 'base.html.twig' %}

{% block stylesheets %}
  <style>
    .article-form {
      margin: 0 auto; 
      text-align: center; 
      max-width: 800px;
    }
    .article-form .hashtag-box {
      margin-bottom: 15px;
    }
    .article-form .content-box {
      margin-bottom: 15px;
    }
    .article-form .hashtag-list li {
      border-radius: 5px;
      display: inline-block;
      margin: 3px;
      padding: 5px;
      list-style-type: none;
      background-color: #d6ecfa;
      color: #00b9f1;
    }
    .article-form .hashtag-list li span {
      cursor: pointer;
      font-weight: bold;
      margin-left: 3px;
      color: #404146;
    }
    .navbar-b.navbar-reduce {
      padding-bottom: 0;
    }
  </style>
{% endblock %}

{% block javascripts %}
  <script>
    $(function(){
      // 해시태그 객체
      var hashtags = {};

      // 해시태그 객체 추가
      function addHashtag(value) {
        var idx = Object.keys(hashtags).length;
        hashtags[idx] = value;
        $('.hashtag-list').append(
          '<li>' + 
            value + 
            "<span class='btn-del-hashtag' idx='" + idx + "'>x</span>" +
          "</li>"
        );
      }
      // 해시태그 객체 삭제
      function removeHashtag(idx) {
        if(idx != -1) 
        delete hashtags[idx];
      }
      // 공백검사
      function isEmpty(str) {
        return (!str || 0 === str.length);
      }
      // 키보드검사
      function isKeyboard(keyCode) {
        return (keyCode == 32 | keyCode == 13) ? true : false;
      }
      // 폼 취소버튼 스크립트
      $("#cancel").click(function(){
        $(location).attr('href', "{{ url('blog_index') }}");
      });
      // 해시태그 삭제버튼 스크립트
      $(document).on('click', '.btn-del-hashtag', function(event) {
        
        var hashtag = $(this);
        var idx     = $(this).attr('idx');

        removeHashtag(idx);

        hashtag.parent().remove();
        console.log(hashtags);
      });
      // 해시태그 키보드 스크립트
      $("#hashtag").keydown(function(event) {
        
        var hashtag = $(this);

        if(isKeyboard(event.keyCode)) {
          event.preventDefault();
          var hashtagValue = $(this).val().trim();

          if(!isEmpty(hashtagValue)) {
            addHashtag(hashtagValue);
            hashtag.val('');
          }
        }
      });
    });
  </script>
{% endblock %}

{% block nav %}
  <nav class="navbar navbar-b navbar-trans navbar-expand-md fixed-top" id="mainNav">
    <div class="container">
      <a class="navbar-brand js-scroll" href="{{ path('blog_index') }}">{{ 'front.home'|trans }}</a>
    </div>
    <div class="navbar-collapse collapse justify-content-end" id="navbarDefault">
      <ul class="navbar-nav">
        {% if app.user %}
          <li class="nav-item"><a class="nav-link js-scroll" href="#"><small>{{ app.user.email }}</small></a></li>
          <li class="nav-item"><a class="nav-link js-scroll" href="{{ path('sec_logout') }}"><i class="fa fa-sign-out fa-lg"></i></a></li>
        {% else %}
          <li class="nav-item"><a class="nav-link js-scroll" href="{{ path('sec_login') }}"><i class="fa fa-user-circle fa-lg"></i></a></li>
        {% endif %}
      </ul>
    </div>
  </nav>
{% endblock %}
{% block main %}
<div class="article-form">    
  
  <h1 class="h3 mb-3 font-weight-normal" style="margin: 30px 0;">{{ 'front.blog.article'|trans }}</h1>
    
  {{ form_start(form, {'attr': {'novalidate': 'novalidate'}}) }}
    <div>
      <input type="hidden" name="_csrf_token" value="{{ csrf_token('user') }}"/>
    </div>
    <diV>
      {{ form_row(form.category) }}
    </div>
    <diV>
      {{ form_row(form.visible) }}
    </div>
    <div>
      {{ form_row(form.title) }}
    </div>
    <div class="hashtag-box">
      <div><ul class="hashtag-list"></ul></div>
      <div><input id="hashtag" name="hashtag" type="text" class="form-control" placeholder="{{ 'front.blog.article.hashtag.placeholder'|trans }}" /></div>
    </div>
    <div class="content-box">
      {{ form_widget(form.content) }}
      {{ form_errors(form.content) }}
    </div>
    <div class="submit-box">
      <button id="cancel" type="button" class="btn btn-danger">{{ 'front.blog.article.cancel'|trans }}</button>
      <button id="submit" type="submit" class="btn btn-primary">{{ 'front.blog.article.submit'|trans }}</button>
    </div>
  {{ form_end(form) }}
</div>
{% endblock %}